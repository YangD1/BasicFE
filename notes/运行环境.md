# 运行环境
## JavaScript 的运行环境
- 通常只运行在客户端（浏览器端，Nodejs可以运行在 server 端）
- 下载网页代码，渲染出页面，期间会执行若干 JS
- 要保证代码在浏览器中：稳定且高效

## 运行环境的应用优化
- 网页加载过程
- 性能优化
- 安全

## 网页加载过程
### 典型题目
- 从输入 url 到渲染出页面的整个过程
- window.onload 和 DOMContentLoaded 的区别

### 知识点
- 加载资源的形式
- 加载资源的过程
- 渲染页面的过程

#### 网页是如何加载并渲染出来的
##### 资源的形式（第一个知识点）
- html 代码
- 媒体文件（图片，视频等）
- javascript css

##### 加载过程（第二个知识点）
- DNS（domain name server） 解析：域名 -> IP 地址（口述就是：域名解析到ip地址）
- 浏览器根据 IP 地址向（通过系统的网络服务）服务器发起 http 请求
- 服务器处理 http 请求，并返回给浏览器
> 以上每个过程都可以展开说，包括三次握手四次挥手之类的计算机网络基础的内容，[具体参考](https://hit-alibaba.github.io/interview/basic/network/TCP.html)

##### 渲染过程 - 1（第三个知识点）
- 根据 HTML 代码生成 DOM Tree
- 根据 CSS 代码生成 CSSOM（css object model）
- 将 DOM Tree 和 CSSOM 整合（合并）成 [Render Tree](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction?hl=zh-cn)
> 在网页加载中发现css文件都会重新render，所以为了避免我们重复渲染，我们都将 css 文件放在 head 中

##### 渲染过程 - 2
- 根据 Render Tree 渲染页面
- 遇到 `<script>` 则暂停渲染，优先加载并执行 JS 代码，完成再继续
- 直至把 Render Tree 渲染完成
> 因为 JS 可能会改变我们已经渲染的 DOM 结构，所以会优先运行 JS
> 为了防止 DOM 渲染速度缓慢，一般将 JS 文件引入放在最后，让 DOM 先渲染完

##### window.onload 和 DOMContentLoaded
```javascript
window.addEventListener('load', function() {
  // 页面的全部资源加载完才会执行，包括图片、视频等
})

document.addEventListener('DOMContentLoaded', function () {
  // DOM 渲染完即可执行，此时图片、视频还可能没有加载完
})
```
